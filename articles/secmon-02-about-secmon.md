---
title: "Google Cloudで作るセキュリティ監視基盤(2): セキュリティ監視およびセキュリティ監視基盤とは"
emoji: "🔎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["security", "monitoring"]
published: false
---

この記事はアドベントカレンダー[Google Cloudで作るセキュリティ監視基盤](https://adventar.org/calendars/xxxx)の2日目です。

基盤の構築の話をする前に、まずそもそも「セキュリティ監視」とは何か、そして「セキュリティ監視基盤」とは何かについて整理をしたいと思います。

# セキュリティ監視とは

本稿では、セキュリティ監視を **「組織内で発生するセキュリティ上の問題を、継続的に検知・調査をすること」** と定義します。

## セキュリティ上の問題

セキュリティ上の問題とは、脆弱性や攻撃活動の兆候、そしてインシデントなどを指しています。

脆弱性は、システムやアプリケーションに存在するセキュリティ上の不備・欠陥であり、悪用されることでセキュリティインシデントが発生する可能性があります。これは自分たちが利用しているソフトウェア、システム、サービスだけでなく、自分たちが開発・運用しているものにも対象となります。開発・運用しているサービスの場合、自分たちが書いたコードに問題があるだけでなく、利用しているライブラリやフレームワークにも問題がある可能性があります。またビルドする環境やデプロイのプロセスに問題がある場合もあります。

攻撃活動の兆候は、悪意ある第三者による攻撃活動が行われている可能性を示す情報です。これは、不審なアクセスログや通信ログ、異常なトラフィックなどが該当します。Exploitコードなどを利用した明らかな攻撃の痕跡だけでなく、調査活動や情報収集活動、侵入のための準備活動なども含まれます。さらに適切な権限を奪取したことで正規のユーザーとして振る舞うような活動もあります。

セキュリティインシデントは、セキュリティ上の問題が発生したことを指し、悪意ある第三者による不正アクセスや情報漏洩、システムのダウンなどが該当します。これは先程の脆弱性や攻撃活動の兆候が実際に悪用され、なんらかの影響がでている状態を指します。

これらのセキュリティに影響を及ぼしそうな問題全般を検知し、対応できるようにすることがセキュリティ監視の目的です。

## 継続的な検知・調査

「継続的に」とは、監視を一定期間ごとに行うのではなく、日常的に実施し問題が発生した際には即座に対応できるようにするという意味です。セキュリティ上の問題を発見するためのアプローチとしては「監査」というものもあります。監査は、ある時点でのシステムやアプリケーションの状態を確認し、問題がないかどうかを検証するものです。多くの場合、監査は人手と時間をかけて実施するものであり、頻繁には実施できません。一方でセキュリティ監視は、機械的に対象の情報を収集、分析できるような仕組みを用意することで、継続的に問題を検出し、即時の対応をすることが目的です。

ここでいう「即時」とはどの程度の速さを示すのでしょうか。例えば Crowd Strike 社が提唱している[1-10-60の法則](https://www.crowdstrike.com/resources/crowdcasts/the-1-10-60-minute-challenge-a-framework-for-stopping-breaches-faster/)においては、攻撃を検知してから1分以内にアラートを出し、10分以内に調査を開始し、60分以内に対応を完了することが求められています。実際には、この数値は環境や組織によって異なりますが、もっともシビアにセキュリティインシデントに対応するための目安として参考になります。

また監視は大きく分けると、検知と調査という2つの役割があります。

- 検知：収集した情報を分析し、問題が発生しているかどうかを判断する機能。破壊的な行動を発見するだけでなく、潜在的な問題やリスクを発見することも含まれます。これは機械的に実施されるだけでなく、人間が専門知識と経験、文脈を活用して実施することもあります。
- 調査：検知された問題に対して、その原因や影響を調査する機能。問題の深刻さや影響範囲を把握し、対応策を検討するための情報を提供します。特にセキュリティの場合、攻撃を検知したとしてもそれがどのような影響を及ぼすかという情報がないと、インシデントであるかの判断が困難であり、調査はそのための重要なステップです。

この2つの機能は表裏一体ですが、この2つの役割を満たせるようなセキュリティ監視基盤を構築することが求められます。

:::message
 「セキュリティ監視」も広義の「監視」に含まれますが、広義の「監視」はよりSRE的な文脈が強くあらわれます。広義の「監視」は、着眼点も可用性やパフォーマンスといったものがより中心的になっています。（参考文献：[入門監視](https://www.oreilly.co.jp/books/9784873118642/)  2019 Mike Julian 著、松浦 隼人 訳 ）
:::

# なぜセキュリティ監視が必要か

では、なぜセキュリティ監視が必要なのでしょうか。セキュリティ監視によって検知する以前に攻撃を防いでいれば、セキュリティ監視は不要ではないかと思われるかもしれません。

実際、この考えは正しいです。セキュリティ監視は、すべての防御的対策より優先されるべきものではありません。低コストかつ少ない影響で実施できる防御的対策は多くあり、まずはそれらを優先するべきです。監視は時としてインシデントを見つける、つまり被害が発生している状況を発見するための手段であり、防御的対策の補完として位置づけられるべきです。

しかし、防御的対策はいくつかの観点で限界があります。

- **対策の抜け漏れ**：防御的対策は基本的に脆弱性を解消するためのものですが、すべての脆弱性を把握できているかどうかはわかりません。すべて対応したつもりでも、それは「見えている範囲」の脆弱性であり、すべての脆弱性を把握できているかどうかは、まさに[悪魔の証明](https://ja.wikipedia.org/wiki/%E6%82%AA%E9%AD%94%E3%81%AE%E8%A8%BC%E6%98%8E)です。また、脆弱性の状況は日々変化しており、新たな脆弱性が発生することもありえます。
- **サプライチェーン攻撃**：自組織のシステムやアプリケーションだけでなく、サプライヤーやパートナーのシステムやアプリケーションにも脆弱性が存在する可能性があります。これらの脆弱性は自組織からはコントロールできないばかりか、観測することも難しい場合があります。脆弱性の悪用を防ぐのが難しい場合、なんらか別の手段で対応する必要があります。
- **ゼロデイ攻撃**：脆弱性が公開されてから対策が公開されるまでの期間や、脆弱性が公開される前にその脆弱性を悪用する、いわゆるゼロデイ攻撃が存在します。これらの攻撃は、対策が公開されるまでの間、防御的対策を講じることが難しかったり、過去に遡って脆弱性の影響を受けなかったかの調査を求められることがあります。防御的対策によって影響を緩和させることはできますが、何らか別の手段での対応が効果的です。
- **ユーザビリティの問題**：防御的対策は攻撃者の活動を制限するだけでなく、自組織内のユーザにも影響を与えることがあります。特にソフトウェアやシステムの使いやすさを犠牲にすることが多いです。

# セキュリティ監視基盤とは

セキュリティ監視基盤とは、セキュリティ監視を支えるためにログ収集、保全、分析、アラート検知、対応をするための情報システムです。セキュリティ監視基盤は、セキュリティ監視に特化したデータウェアハウス（DWH）とも言えます。

## ログ収集

ログ収集は、システムやアプリケーションが出力するログを収集する機能です。ログは、システムやアプリケーションの状態や動作、ユーザのアクセス履歴などを記録したものであり、セキュリティ監視においては重要な情報源となります。

セキュリティ監視で取り扱うログは幅広く、自組織でログの内容やスキーマ、取得方法をコントロールできないログがほとんどであるという特徴があります。これは、自組織以外のクラウドサービスや既製ソフトウェアからのログを取り扱うためです。また、ログの形式や出力方法も多様であり、それらを統一的に収集するための仕組みが必要です。

## ログ保全

ログ保全は、収集したログを保存する機能です。ログは、セキュリティインシデントの調査や分析、法的な要求に対応するために長期間保存する必要があります。また、ログは改ざんされないように保護される必要があります。これは、ログの完全性を保つための技術的な手段だけでなく、ログの保存期間やアクセス権限を管理するための組織的な手段も含まれます。

## ログ分析・アラート検知

ログ分析は、収集したログを解析し、異常を検知する機能です。ログは大量に生成されるため、人手でログを解析することは困難です。そのため、ルールベースや統計的手法によってログを解析し、疑わしい事象やインシデントそのものを検知することが一般的です。

## アラート対応

アラート対応は、検知された異常を対応するための機能です。アラートは、異常を検知した際に通知するための手段であり、アラートを受け取った担当者がその内容を確認し、必要な対応を行います。アラート対応は、アラートを受け取った担当者が適切な対応を行うための情報を提供することが求められます。

# セキュリティ監視を導入するメリット・デメリット

- メリット：ユーザビリティ、追跡性の確保
- デメリット：構築、運用コスト
