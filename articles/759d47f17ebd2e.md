---
title: "OPAã‚’AWS Lambdaã¸ãƒ‡ãƒ—ãƒ­ã‚¤"
emoji: "ğŸš¶"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["opa", "rego", "aws", "cdk", "go"]
published: true
---

ã“ã®è¨˜äº‹ã¯[OPA/Regoã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://adventar.org/calendars/6601)ã®17æ—¥ç›®ã§ã™ã€‚

ä»Šå›ã¯OPAã®æ©Ÿèƒ½ã‚’AWS Lambdaã§å®Ÿè£…ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

# AWS Lambda ã«ãŠã‘ã‚‹OPAåˆ©ç”¨ã®æˆ¦ç•¥

AWS Lambdaã¯Fargateã‚„GCP Cloud Runã¨ã¯ç•°ãªã‚Šã€ç´”ç²‹ã«ã€Œé–¢æ•°ã€ã¨ã—ã¦ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚é–¢æ•°ã®å‘¼ã³å‡ºã—ã‚‚å„è¨€èªã®SDKã‚’çµŒç”±ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€æ—¢å­˜ã®ãƒã‚¤ãƒŠãƒªã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã®ã¯å›°é›£ã§ã™ã€‚ã¤ã¾ã‚Š GCP Cloud Run ã€ã‚ã‚‹ã„ã¯ AWS ECSãƒ»Fargateã®ã‚ˆã†ã«ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„ãƒã‚¤ãƒŠãƒªã‚’ãã®ã¾ã¾ä½¿ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€æ¬¡ã®2ã¤ã®ã©ã¡ã‚‰ã‹ã®æ–¹é‡ã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## 1) ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’çµ„ã¿è¾¼ã‚“ã Lambdaé–¢æ•°ã‚’è‡ªä½œã™ã‚‹

`github.com/open-policy-agent/opa/rego` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å–ã‚Šè¾¼ã‚“ã Goè¨€èªãƒ™ãƒ¼ã‚¹ã®Lambdaé–¢æ•°ã‚’ä½œã‚Šã€ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã§ã™ã€‚ä»Šå›ã®è¨˜äº‹ã§ã¯ã“ã¡ã‚‰ã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

- ãƒ¡ãƒªãƒƒãƒˆ
    - æ§‹æˆãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹ï¼šä¸€èˆ¬çš„ãªLambdaã®åˆ©ç”¨æ–¹æ³•ã«ãã£ãŸå½¢ã«ãªã‚‹ã®ã§å…ˆè¡Œäº‹ä¾‹ã‚’å‚ç…§ã—ã‚„ã™ãã€ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®å¯¾å¿œãŒæ¯”è¼ƒçš„æ¥½ã«ãªã‚‹ã¨æœŸå¾…ã•ã‚Œã¾ã™
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒï¼ˆè‹¥å¹²ï¼‰è‰¯ããªã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã‚‹ï¼š1ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã ã‘ã§å‹•ã‹ã™ãŸã‚ã€ãƒ¡ãƒ¢ãƒªã®æ¶ˆè²»é‡ãªã©ã§æ¯”è¼ƒçš„æœ‰åˆ©ã«ãªã‚Šã¾ã™
- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
    - è‡ªåˆ†ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ï¼šä¾‹ãˆã°è¤‡æ•°ã®ãƒãƒªã‚·ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã„ãŸã„ç­‰ã®å ´åˆã«ã€ãã®ã‚ãŸã‚Šã®åˆ¶å¾¡ã‚’è‡ªåˆ†ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãŸã ã“ã‚Œã¯opaã‚³ãƒãƒ³ãƒ‰ã®åˆ¶ç´„ã«ç¸›ã‚‰ã‚Œãªã„ã¨ã„ã†è¦‹æ–¹ã‚‚ã§ãã¾ã™
    - ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãŒåˆ¶é™ã•ã‚Œã‚‹ï¼šç¾çŠ¶ã ã¨ã€OPAã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹Goè¨€èªã€ã‚ã‚‹ã„ã¯[WASMãŒæä¾›ã•ã‚Œã¦ã„ã‚‹node](https://github.com/open-policy-agent/npm-opa-wasm)ã®ã©ã¡ã‚‰ã‹ãŒç¾å®Ÿçš„ãªé¸æŠè‚¢ã«ãªã‚Šã¾ã™

## 2) opaã‚³ãƒãƒ³ãƒ‰ã‚’åŒæ¢±ã—ã¦Lambdaé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€èµ·å‹•ã•ã›ã‚‹

Lambdaé–¢æ•°ã¯å®Ÿè¡Œã«å¿…è¦ãªãƒã‚¤ãƒŠãƒªãªã©ã‚’ã‚¢ã‚»ãƒƒãƒˆã¨å‘¼ã°ã‚Œã‚‹ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«ã¾ã¨ã‚ã¦ãã‚Œã‚’å±•é–‹ã—èµ·å‹•ã—ã¾ã™ã€‚ãã“ã§ãã®ã‚¢ã‚»ãƒƒãƒˆã«opaã‚³ãƒãƒ³ãƒ‰è‡ªä½“ã‚’åŒæ¢±ã•ã›ã€Lambdaé–¢æ•°ã‹ã‚‰åˆ¥ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦èµ·å‹•ã•ã›ã‚‹æ–¹æ³•ã§ã™ã€‚

- ãƒ¡ãƒªãƒƒãƒˆ
    - opaã‚³ãƒãƒ³ãƒ‰ã®æ©æµã‚’å—ã‘ã‚‰ã‚Œã‚‹ï¼šãƒãƒªã‚·ãƒ¼ç®¡ç†ãªã©ã®å´é¢ã§ã€opaã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ãŒãã®ã¾ã¾åˆ©ç”¨ã§ãã¾ã™
    - ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¯è‡ªç”±ã«é¸æŠã§ãã‚‹ï¼šã‚³ãƒãƒ³ãƒ‰ã‚’èµ·å‹•ã™ã‚Œã°ã„ã„ã ã‘ãªã®ã§ã€ç¾çŠ¶Lambdaã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹è¨€èªã§ã‚ã‚Œã°ã©ã‚Œã§ã‚‚åˆ©ç”¨ã§ãã¾ã™
- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒï¼ˆè‹¥å¹²ï¼‰æ‚ªã„ã‹ã‚‚ã—ã‚Œãªã„ï¼šä¸€æ¦‚ã«ã¯è¨€ãˆã¾ã›ã‚“ãŒã€Lambdaå†…éƒ¨ã§ã•ã‚‰ã«ã‚‚ã†1ã¤ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‹•ã‹ã™ã“ã¨ã«ãªã‚‹ãŸã‚ã€Lambdaã‹ã‚‰ç›´æ¥å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã ã‘ã§å‡¦ç†ã™ã‚‹ã®ã«æ¯”ã¹ã‚‹ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çš„ã«ä¸åˆ©ãªå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚1åˆ†é–“ã«æ•°å›å‘¼ã°ã‚Œã‚‹ç¨‹åº¦ã§ã‚ã‚Œã°å•é¡Œã«ãªã‚‰ãªã„ã¨æ€ã‚ã‚Œã¾ã™ãŒã€æ¯ç§’æ•°åã€æ•°ç™¾å›å‘¼ã°ã‚Œã‚‹ã‚ˆã†ãªä½¿ã‚ã‚Œæ–¹ã®å ´åˆã¯å¤§ããã‚³ã‚¹ãƒˆã«å·®ãŒã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
    - æ§‹æˆãŒè¤‡é›‘ã«ãªã‚‹ï¼šLambdaå†…éƒ¨ã§åˆ¥ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã¨ã„ã†ã®ã¯ã‚„ã‚„è£æŠ€çš„ãªä½¿ã„æ–¹ã§ã‚ã‚Šã€å…ˆè¡Œäº‹ä¾‹ã‚‚ã‚ã¾ã‚Šå¤šãã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãŸãƒã‚¤ãƒŠãƒªã‚’åŒæ¢±ã™ã‚‹ã®ã«ã‚‚ã‚³ãƒ„ãŒå¿…è¦ã ã£ãŸã‚Šã€ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã«ãƒ—ãƒ­ã‚»ã‚¹å†…éƒ¨ã®çŠ¶æ³ã‚’è¦‹ãªãŒã‚‰ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã“ã¨ãŒã§ããªã„ãªã©ã®åˆ¶ç´„ãŒã‚ã‚‹ãŸã‚ã€é‹ç”¨ã«ã¯ä¸€å®šã®ç­‹åŠ›ãŒå¿…è¦ã«ãªã‚Šã¾ã™

# AWS Lambda + OPA ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

ã§ã¯ãã‚“ãªé¢å€’ãªã“ã¨ã‚’ã—ã¦Lambdaã§OPAã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚‹ã®ã‹ï¼ˆFargateãªã©ã§ä½¿ãˆã°ã„ã„ã®ã§ã¯ãªã„ã‹ï¼‰ã¨ã„ã†ç–‘å•ã«å¯¾ã—ã¦ã€ã„ãã¤ã‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

- Cloudfront Lambda@Edgeï¼šCloudfrontçµŒç”±ã§é€ã‚‰ã‚Œã¦ããŸHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’Lambdaã§å—ã‘ã¦èªå¯ã®åˆ¶å¾¡ãŒã§ãã‚‹ãŸã‚ã€ãã®èªå¯ãƒãƒªã‚·ãƒ¼ã‚’Regoã§è¨˜è¿°ã—ã¦ç®¡ç†ã™ã‚‹ã¨ã„ã†ä½¿ã„æ–¹ãŒã§ãã¾ã™
- Kinesis Data Firehoseï¼šLambdaã‚’ä½¿ã£ãŸtransformæ©Ÿèƒ½ãŒã‚ã‚Šã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã‚„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã€ãªã©ã®åˆ¤å®šã‚’Regoã§è¨˜è¿°ã—ã¦ç®¡ç†ã§ãã¾ã™
- API gatewayï¼šãƒãƒªã‚·ãƒ¼ã®åˆ¤å®šãŒç¨€ã«ã—ã‹ç™ºç”Ÿã—ãªã„å ´åˆã€HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’API gatewayã§å—ã‘å–ã‚ŠLambdaå†…ã®Regoã§åˆ¤å®šã—ãŸçµæœã‚’ãã®ã¾ã¾å¿œç­”ã™ã‚‹ã¨ã„ã†æ§‹æˆã«ã™ã‚‹ã“ã¨ã§ã€Fargateãªã©ã§ã®èµ·å‹•ã«æ¯”ã¹ã¦å¤§å¹…ã«ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã§ãã¾ã™
- CloudWatch Eventï¼šAWSå†…ã§ç™ºç”Ÿã—ãŸæ§˜ã€…ãªã‚¤ãƒ™ãƒ³ãƒˆã‚’CloudWatchçµŒç”±ã§LambdaãŒå—ã‘å–ã‚Œã¾ã™ã€‚äº‹è±¡ãŒèµ·ã“ã£ãŸå¾Œãªã®ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¸­æ­¢ã¯ã§ãã¾ã›ã‚“ãŒã€ãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’ä¸Šæ›¸ãã—ãŸã‚Šã€ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç”Ÿã‚’é€šçŸ¥ã™ã‚‹ã€ã¨ã„ã†ã‚ˆã†ãªéƒ¨åˆ†ã®åˆ¤å®šã«Regoã‚’åˆ©ç”¨ã§ãã¾ã™

# ãƒ‡ãƒ—ãƒ­ã‚¤ã®æ–¹æ³•

ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã«ç½®ã„ã¦ã‚ã‚‹ã®ã§é©å®œã”å‚ç…§ãã ã•ã„ã€‚
https://github.com/m-mizutani/rego-sandbox/tree/main/integration/cdk

## Prerequisite

ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¸ˆã¿ã¨ã—ã¾ã™ã€‚

- [go](https://go.dev/doc/tutorial/getting-started) >= 1.17
- [Node.js and npm](https://nodejs.org/en/download/package-manager/) >= v17.0.1
- [AWS CDK](https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html#getting_started_install) >= 1.134.0

## CDKã‚¢ãƒ—ãƒªã®ä½œæˆ

ä¸€èˆ¬çš„ãªæ‰‹é †ã§CDKç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚è¿½åŠ ã—ã¾ã™ã€‚

```bash
$ mkdir cdk
$ cd cdk
$ cdk init --language typescript
$ npm i @aws-cdk/aws-lambda
```

CDKã®stackã‚’ä½œæˆã—ã¾ã™ã€‚ä»Šå›ã¯ã‚µãƒ³ãƒ—ãƒ«ã¨ã„ã†ã“ã¨ã§æœ€ä½é™ã®Lambdaã ã‘ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

```ts:lib/cdk.ts
import * as cdk from "@aws-cdk/core";
import * as lambda from "@aws-cdk/aws-lambda";

export class CdkStack extends cdk.Stack {
  constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    new lambda.Function(this, "main", {
      runtime: lambda.Runtime.GO_1_X,
      // ./build/main ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ãƒã‚¤ãƒŠãƒªãŒç½®ã‹ã‚Œã‚‹æƒ³å®š
      handler: "main",
      code: lambda.Code.fromAsset("./build"),
    });
  }
}
```

```ts:bin/cdk.ts
#!/usr/bin/env node
import "source-map-support/register";
import * as cdk from "@aws-cdk/core";
import { CdkStack } from "../lib/cdk-stack";

const app = new cdk.App();
new CdkStack(app, "opa-test", {
  env: {
    account: process.env.AWS_ACCOUNT,
    region: process.env.AWS_REGION,
  },
});
```

ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã¯ç’°å¢ƒå¤‰æ•°ã§ `AWS_ACCOUNT` (AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID)ã€`AWS_REGION` (AWSã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³) ã‚’è¨­å®šã™ã‚‹ã€ã‚‚ã—ãã¯ `bin/cdk.ts` ã«ç›´æ¥å€¤ã‚’æ›¸ãè¾¼ã‚“ã§ãã ã•ã„ã€‚

ã¾ãŸã€CDKã®åˆ©ç”¨ãŒåˆã‚ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼†ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§AWSå´ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦ã§ã™ã€‚ï¼ˆä¾‹ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDãŒ `111111111111`ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒ `us-east-1` ã®å ´åˆï¼‰

```bash
cdk bootstrap aws://111111111111/us-east-1
```

## Goã®ã‚³ãƒ¼ãƒ‰ï¼†ãƒãƒªã‚·ãƒ¼ã®ç”¨æ„

`./lambda/main.go` ã«æœ¬ä½“ã¨ãªã‚‹Lambdaã®ã‚³ãƒ¼ãƒ‰ã‚’é…ç½®ã—ã¾ã™ã€‚

```go:lambda/main.go
package main

import (
	"context"
	_ "embed"
	"fmt"

	"github.com/aws/aws-lambda-go/lambda"
	"github.com/open-policy-agent/opa/rego"
)

//go:embed policy/example.rego
var module string

func HandleRequest(ctx context.Context, input interface{}) (interface{}, error) {
	fmt.Println("input =>", input)

	q := rego.New(
		rego.Query(`x := data`),
		rego.Module("policy/example.rego", module),
		rego.Input(input),
	)

	rs, err := q.Eval(ctx)
	if err != nil {
		panic(err)
	}

	if len(rs) == 0 {
		return nil, nil
	}

	return rs[0].Bindings["x"], nil
}

func main() {
	lambda.Start(HandleRequest)
}
```

Regoãƒãƒªã‚·ãƒ¼ã‚’ç›´æ¥Goã®ã‚³ãƒ¼ãƒ‰å†…ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€ãã‚Œã ã¨Regoãƒãƒªã‚·ãƒ¼ã¨ã—ã¦ã®ãƒ†ã‚¹ãƒˆãªã©ãŒã§ããªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãã“ã§ä¸Šè¨˜ä¾‹ã§ã¯ `.rego` ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¸Šè¨˜ä¾‹ã§ã¯ `lambda/policy/example.rego` ã«é…ç½®ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’Go 1.16ã§å°å…¥ã•ã‚ŒãŸ[embedæ©Ÿèƒ½](https://pkg.go.dev/embed)ã‚’åˆ©ç”¨ã—ã¦å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Goã®ã‚³ãƒ¼ãƒ‰ã¸åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚

```rego:lambda/policy/example.rego
package example

allow {
    input.user == "mizutani"
}
```

ä»–ã«ã‚‚[CDKã®bundlingæ©Ÿèƒ½](https://aws.amazon.com/jp/blogs/devops/building-apps-with-aws-cdk/)ã‚’ä½¿ã£ã¦åŒæ¢±ã•ã›ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã€å¿…è¦ã«å¿œã˜ã¦é¸æŠã§ãã¾ã™ã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤

cdkã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚æ‰‹å…ƒã‹ã‚‰å®Ÿè¡Œã™ã‚‹éš›ã¯ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«[èªè¨¼æƒ…å ±ã‚’è¨­å®šã™ã‚‹](https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds)å¿…è¦ãŒã‚ã‚‹ç‚¹ã«ã”æ³¨æ„ãã ã•ã„ã€‚

```bash
$ cdk deploy
opa-test: deploying...
[0%] start: Publishing 3b2c355b98c83def54cb691d70c2043ad8291728a3cd8c7bc5de1aeaf1a3f5b5:current
[100%] success: Published 3b2c355b98c83def54cb691d70c2043ad8291728a3cd8c7bc5de1aeaf1a3f5b5:current
opa-test: creating CloudFormation changeset...

 âœ…  opa-test

Stack ARN:
arn:aws:cloudformation:ap-northeast-1:111111111111:stack/opa-test/91193c30-4f79-11ec-8483-06782e15d9b5
```

## ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰å®Ÿè¡Œã—ã¦ã¿ã‚‹

AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰Lambdaã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸé–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€CloudFormationã®ã‚¹ã‚¿ãƒƒã‚¯ä¸€è¦§ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰æ¢ã—ãŸã»ã†ãŒæ—©ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ap-northeast-1ã®å ´åˆ
- Lambda functions: https://ap-northeast-1.console.aws.amazon.com/lambda/home?region=ap-northeast-1#/functions
- CloudFormation stacks: https://ap-northeast-1.console.aws.amazon.com/cloudformation/home?region=ap-northeast-1#/stacks?filteringStatus=active&filteringText=&viewNested=true&hideStacks=false

![](https://storage.googleapis.com/zenn-user-upload/72df3f374753-20211128.png)

ã€Œãƒ†ã‚¹ãƒˆã€ã‚¿ãƒ–ã‚’é–‹ããƒ†ã‚¹ãƒˆç”¨ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’è¨˜è¿°ã—ã€å¤‰æ›´ã‚’ä¿å­˜ â†’ ãƒ†ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/4230b714097a-20211128.png)

æ­£ã—ãå®Ÿè¡Œã•ã‚Œã‚‹ã¨OPAã§è©•ä¾¡ã•ã‚ŒãŸçµæœãŒè¿”ã•ã‚Œã¾ã™ã€‚