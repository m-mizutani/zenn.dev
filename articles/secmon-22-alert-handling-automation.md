---
title: "実践セキュリティ監視基盤構築(22): アラート対応自動化の実装要点"
emoji: "🔎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["security", "monitoring"]
published: true
---

この記事はアドベントカレンダー[実践セキュリティ監視基盤構築](https://adventar.org/calendars/9986)の22日目です。前回に引き続きアラート対応の話で、自動化におけるポイントを解説します。

# アラート対応自動化の実装方針

## SOAR

アラート対応の自動化といえば、そのものズバリなプロダクトが[SOAR（Security Orchestration, Automation and Response）](https://www.gartner.com/en/information-technology/glossary/security-orchestration-automation-response-soar)です。2017年ごろにGartnerが提唱した比較的新しい概念で、セキュリティ監視からアラート対応とインシデント対応を自動化するためのプラットフォームです。この概念が現れた当時はアラート・インシデント対応の全てを自動化できると期待されていましたが、実態としては例外ケースが多く完全自動化は難しいという見方[^Gorka][^darkreading]になりつつあり、GartnerのHype Cycle for Security Operations 2024では幻滅期に位置付けされています。

なぜSOARの期待が外れたのか、その理由はいくつか考えられます。

- ⚠️ **完全な自動化は難しい**: 主要な発生頻度の多い手続きのみを自動化する場合は大きな効果を発揮しますが、細かく頻度が低い手続きまで自動化しようとすると効率化と運用のコストが逆転してしまいます。
- ⚠️ **重厚なフレームワークは過剰**: 自動化そのものは効果がありますが、SOARという独立のプラットフォームを導入する必要が必ずしもないという点があります。既存のワークフローオーケストレーションツールやチケットシステムを活用することで十分な場合もあります。

これらのことから自動化そのものへの需要はあるものの、SOARという独立したプラットフォームをあえて利用する必要はないのではないか、という考え方があるようです。

[^Gorka]:SOAR is dead, long live the SOAR, https://gorkasadowski.medium.com/soar-is-dead-long-live-the-soar-3af6efed730b
[^darkreading]: https://www.darkreading.com/cybersecurity-operations/soar-is-dead-long-live-soar

## 今回のアプローチ

上述した通りSOARという独立したプラットフォームに依存する必要はないという考え方が広まっていますが、今回はあえて独立したアラート対応のワークフローを実装します。これは以下のような理由があります。

- **内製することが前提であるためどこに実装しても開発コストは変わらない**: SOARが不要とされる理由の一つとしてSIEMなどにすでに機能として組み込まれているため、別途SOARを導入する必要がないという考え方があります。しかし今回はそもそも全体的に自分たちで実装するため、機能としてはどこかしらに実装する必要があり、開発コストは大きくは変わりません。
- **外部からのアラートも受け付ける**: 先述した通り、今回のアーキテクチャでは外部システムで検知されたアラートも取り込んで処理します。その場合、アラート対応のワークフローが独立していることで、外部システムとの連携がしやすくなります。

もちろん独立したワークフローにすることで運用負荷が高くなることを懸念し、アラート検知機能と密結合した機能として実装するというアプローチもあります。この方針については各組織ごとに検討する余地があると考えられます。

# ワークフローの実装ポイント

ではワークフローの実装においてどのようなポイントがあるのかを見ていきたいと思います。


## ✔ 柔軟な分岐とロジックの表現

アラート対応のワークフローは、アラートの内容によって処理が変わることが多いです。例えば、アラートの内容によっては通知だけで済むものもあれば、トリアージや暫定処置が必要なものもあります。そのため、ワークフローの実装においては柔軟な分岐とロジックが求められます。

条件分岐ではなく全てのパターンに応じたワークフローを実装することも考えられますが、その場合はワークフローの管理が複雑になったりワークフローの数が多くメンテナンスなどの負担が大きくなるという懸念があります。

また先述した通り今回のアラート対応のワークフローは外部システムからのアラートを受け付けるため、外部システムからのアラートで不要なものを無視する機能も必要です。外部システム側でフィルタリングすることもできる場合もありますが、それができない場合はワークフロー側でフィルタリングする必要があります。このためにも柔軟な分岐機能やロジックの表現能力が求められます。

## ✔ テスト可能性・自動化

他のコンポーネントの実装でも再三触れてきましたが、アラート対応のワークフローもテスト可能性が重要です。アラート対応の

## ✔ アラートの集約・紐づけ


- 最終的にアラートを受理するかどうかの判断
    - BigQueryでの検出とは別ルートで来るアラートもある（SaaSからの発報など）
    - 他のデータソース（BigQuery外）と組み合わせて判定したい場合
- アラートの集約
    - 通知が滝になると何もできなくなる
    - 適切に集約するためには、アラートに関する知識が必要
        - 通知機能に集約機能がある場合はそれにたよってもよい
- 対応の自動化
    - 鉄板）通知、チケット作成
    - やれそう）バックアップ作成、詳細ログ取得のための監視機能の発火
    - 勇気が必要）隔離、機能停止
- テスト可能性
    - 対応処理も当然ながらテストが必要、むしろ対応処理こそ必要

# ワークフローの実装

## プログラミング言語で構成

## 独自DSLを定義

## ワークフローオーケストレーションサービスの利用

# まとめ
