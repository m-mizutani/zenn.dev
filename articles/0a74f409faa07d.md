---
title: "まとめ"
emoji: "🎄"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["opa", "rego"]
published: false
---

メリークリスマス！ この記事は[OPA/Regoアドベントカレンダー](https://adventar.org/calendars/6601)の最終日、25日目です。というわけでこの連載も最終回を迎えました。今回は最後ということもあり、個別の技術の話ではなく概観というかメタな視点から改めてOPA/Regoについてしたためてみました。

# 改めてOPA/Regoとはなんだったのか

このアドベントカレンダーを始めるにあたって過去に執筆されたOPA/Regoの記事や発表、連携しているツールなどを調べましたが、多くは **クラウドリソースのmiss configurationやポリシー違反を防ぐ** という目的のものが多いように感じていました。例えばKubernetesにデプロイされるリソースに関するポリシーを記述して、ポリシーに違反したリソースのデプロイを止めるための[Gatekeeper](https://open-policy-agent.github.io/gatekeeper/website/docs/)や、terraformなどの設定情報を検査する[Conftest](https://www.conftest.dev/)などが挙げられます。これはOPAが[Cloud Native Computing Foundation](https://www.cncf.io/projects/)のプロジェクトとして成長してきたことにも強く関連していると思います。OPAの仕組みから考えても、近代的なクラウドの監視やInfrastructure as Codeの検査はたしかに相性がよい分野と言えるかと思います。

すでにOPAを活用している企業
2021年8月に開催されていたOpen Policy Agent Rego Knowledge Sharing Meetupでも
https://engineering.mercari.com/blog/entry/20210804-opa-rego/


これらについては先人の資料が多くあったので、今回のアドベントカレンダーでは敢えてあまり振れず、基礎的な部分やより汎用的なユースケースに対応できるような要素についての解説を中心としてきました。

もちろん既存の応用例はクラウドリソースの制御・監視だけではありません。認可の制御も一つの大きなテーマであり、Netflixでは内部APIの認可制御に利用していたり[^netflix]、OPA

一方で新しい潮流もここ最近で見られるようになってきたのではと感じています。[Trivy]()


# OPA/Regoを活用していく

## 何を判断させていくか

- ポリシーを書くのは難しい

## ポリシーを育てる文化

[^netflix]: How Netflix Is Solving Authorization Across Their Cloud [I] - Manish Mehta & Torin Sandall, Netflix https://www.youtube.com/watch?v=R6tUNpRpdnY