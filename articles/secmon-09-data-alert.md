---
title: "Google Cloudで作るセキュリティ監視基盤(9): セキュリティ監視基盤で利用するデータ（アラート編）"
emoji: "🔎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["security", "monitoring"]
published: false
---

この記事はアドベントカレンダー[Google Cloudで作るセキュリティ監視基盤](https://adventar.org/calendars/9986)の9日目です。

先日に引き続き、セキュリティ監視基盤に取り込むデータのうち、「アラート」について解説します。今回は特にセキュリティ監視基盤内で検知するものではなく、外部から取り込まれるアラートについて扱います。

# セキュリティ監視基盤における外部アラートの扱い

本アドベントカレンダーにおけるアラートとは、**セキュリティ上の問題を引き起こしている可能性がある事象**を指します。セキュリティ監視基盤においてログを分析したりルールによって検知したりすることで、アラートを生成することができます。アラートについて調査した結果、実際に影響を及ぼしていると判断された場合、それをセキュリティインシデントとして扱います。

セキュリティ監視基盤としては収集したログからアラートを検知するというのが基本ですが、それ以外にも外部からアラートを取り込むことがあります。わかりやすい例として、PC上で動作するアンチマルウェア製品やネットワークを監視する侵入検知システム（IDS, Intrusion Detection System）が挙げられます。このような既存のセキュリティ対策ソフトウェアやサービスに備わっているアラート検知機能を利用することで、より効率的にセキュリティ監視ができます。

## 外部アラートを採用する理由

セキュリティ監視基盤にログを収集して検知するアラートと比べ、既存のセキュリティ対策ソフトウェア・サービスが検知するアラートを利用するメリットは以下の通りです。

- ✅️ **そのドメインに関する専門の検知ルールが適用される**: 例えば、IDS/IPSやEDRなどのセキュリティ対策ソフトウェア・サービスは、そのドメインに特化した検知ルールを持っています。攻撃者やマルウェアがどのような活動をするについて、長年調査・研究を続けてきた結果が反映してルールが作成・整備されています。そのため自分たちでルールを組むよりも、より高度な検知が期待できます。
- ✅️ **検知ルールがメンテナンスされる**: セキュリティ対策ソフトウェア・サービスは、そのドメインに関する最新の脅威情報を元に検知ルールがメンテナンスされています。自分たちでルールを作成する場合、そのルールが最新の脅威に対応しているかどうかを常に確認する必要がありますが、セキュリティ対策ソフトウェア・サービスを利用することで、その心配がなくなります。また、精度向上のための更新もされており、それによって検知精度が向上することも期待できます。
- ✅️ **検知に必要なログデータの処理がソフトウェア・サービス内で完結している**: セキュリティ対策ソフトウェア・サービスでアラートを検知する場合も、セキュリティ監視基盤と同様に何らかのログを収集し、それにルールを適用するという処理をしています。しかし、この検知のためのログ収集および検知処理そのソフトウェア・サービスで完結しているため、大量のログを取出してセキュリティ監視基盤に取り込むという手間が省けます。また、検知ルールも複雑なため、それを自前で実装する手間も省けます。

これらの理由により、セキュリティ監視基盤においては、セキュリティ対策ソフトウェア・サービスが検知するアラートを活用するのが良いでしょう。ただし、これらのソフトウェア・サービスではカバーしきれない以下のような要素もあるため、自分たちでの検知も同様に必要であるという点を覚えておいてください。

- ❌️ **複数のシステムやデータソースを組み合わせた検知**: セキュリティ対策ソフトウェア・サービスは、そのソフトウェア・サービスが保護する範囲内での検知しかできません。複数のシステムからえられたログを組み合わせて検知するアラートは、セキュリティ監視基盤で行う必要があります。また、独自のIoC（Indicator of Compromise）を用いた検知もセキュリティ対策ソフトウェア・サービスでは難しいため、セキュリティ監視基盤を活用する方が良い場合が多いです。
- ❌️ **過去のログを遡及する検知**: 多くのセキュリティ対策ソフトウェア・サービスは、ある一定期間内のログを対象にして検知する場合が多いです。そのため過去に発生したログに対して新たに得られた情報を元に検知する、というようなことは難しいです。セキュリティ監視基盤ではログの保全の観点から過去に遡及しやすくなっており、セキュリティ対策ソフトウェア・サービスとの差別化となっています。
- 🤔 **組織内のポリシーに基づく検知**: セキュリティ対策ソフトウェア・サービスで用意されている基本的なルールは一般化されたものになっているため、少なくともそのままでは組織内のポリシーに基づくような検知が難しい点に注意が必要です。製品によっては独自のルールを記述することはできますが、原則として無視リストを整備する程度の柔軟性しかありません。組織内のポリシーに基づく検知を行う場合は、セキュリティ監視基盤で自前でルールを作成・運用したほうが便利なケースが多いと考えられます。

## 外部アラートと内部アラートの統合するべきか？

今回設計したアーキテクチャでは、セキュリティ監視基盤の中で検知したアラートと外部のセキュリティ対策ソフトウェア・サービスが検知したアラートを統合して扱うようにしています。しかし、わざわざ手間を掛けてまで統合する必要があるのでしょうか？ これは統合する、しないにそれぞれメリット・デメリットがあります。

- アラートを統合するメリット
  - **アラートの集中管理**: セキュリティ監視基盤内で検知したアラートと外部のセキュリティ対策ソフトウェア・サービスが検知したアラートを一元管理することで、組織全体のアラートの発生状況がわかりやすくなります。見通しが良くなるだけでなく、集計なども容易になります。
  - **対応ワークフローの一元化**: アラートをまとめることで、その後の対応ワークフローも一元化できます。例えば通知をする、追加のメタ情報を収集する、対応者を割り当てる、などの作業を一元的に行うことができます。
- アラートを統合しないメリット
  - **統合にかかるコストの削減**: アラートを統合するためには、システム間の接続を実装する必要があります。システム間の接続は通信経路の確保、認証関連の実装、そしてエラー処理などの実装が必要です。これらの実装には手間と時間がかかるため、統合しないことでそのコストを削減できます。
  - **専用のユーザインターフェースの利用**: セキュリティ対策ソフトウェア・サービスは、そのソフトウェア・サービスが提供する専用のユーザインターフェースを利用することで、アラートの確認や対応を行うことができるものが多いです。セキュリティ監視基盤に統合することで、その専用のユーザインターフェースを利用する機会が減るため、その利便性を活用しきれないというデメリットがあります。ただしこれは、セキュリティ監視基盤のユーザインターフェースに外部アラートへの導線を用意する（リンクを貼るなど）ことで解消できるかもしれません。

まとめると、アラートを統合するかどうかは、検知に使っているセキュリティ対策ソフトウェア・サービスの数と運用体制によって考えるのがよいでしょう。利用しているセキュリティ対策ソフトウェア・サービスが少ないうちは無理に統合せず、個別に運用したほうが小回りもきき良いでしょう。逆にセキュリティ対策ソフトウェア・サービスが多くなると複数のユーザインターフェースを巡回する必要がでてくるため、手間がかかったり対応が煩雑になったり、あるいは見逃しが発生しやすくなるため、統合を検討するのがよいでしょう。

# アラートを検知するセキュリティソフトウェア・デバイス・サービス

セキュリティ監視基盤に取り込むアラートを検知するセキュリティソフトウェア・デバイス・サービスについて紹介したいと思います。ただし、すべての種類の製品を網羅するのが難しいので、筆者が代表的であると考えるものにしぼりたいと思います。これは単純に製品数が多いというのもありますが、概念や機能が重複や派生によって多様化しており、カテゴライズが難しいという理由もあります。

## エンドポイント

- **アンチマルウェア**: ウイルスやマルウェアを検知するためのソフトウェアです。ウイルス定義ファイルを定期的に更新することで、最新の脅威に対応できます。また、EDR（Endpoint Detection and Response）と呼ばれる機能を持つ製品もあり、エンドポイント上での不審な挙動を検知することができます。
- **EDR（Endpoint Detection and Response）**: エンドポイント上での不審な挙動を検知するためのソフトウェアです。主な目的は端末の挙動のログを取得することですが検知の機能を備えている製品も多いです。アンチマルウェアとは異なり、シグネチャベースではなく、挙動ベースで検知を行います。そのため、未知の脅威にも対応できますが、誤検知は比較的多くなる傾向があります。
- **MDM（Mobile Device Management）**: モバイルデバイスの管理を行うためのソフトウェアです。モバイルデバイスのセキュリティポリシーの適用や、デバイスのロックや消去などのリモート操作が本来の用途ですが、自動的に変更できない設定の問題や、不正なアプリのインストールなどを検知する機能も備えている製品もあり、それらをアラートとして扱うことができます。

## ネットワーク

- **IDS、IPS (Intrusion Detection System, Intrusion Prevention System)**: ネットワーク上での不審な挙動を検知するためのソフトウェア・デバイスです。IDSは不審な挙動を検知するだけで、IPSは不審な挙動を検知して遮断することができます。基本的にはパケットのヘッダやペイロードを解析してパターンマッチすることによる検知をしますが、近年では多くの通信が暗号化されるようになったため、検知が難しくなっています。一方で通信の内容ではなく挙動をベースに検知する製品もあるため、それらを利用できる場面もあります。
- **ハニーポット**: 不正アクセスを誘導するための罠として設置されたサーバです。本来は攻撃者を誘い込み、攻撃手法などを分析するために利用され、検知を目的としたものではありません。しかし、本来アクセスが発生し得ないネットワークに設置しておくことで、攻撃者がネットワークに侵入した後に偵察などをしているのを検知することができます。

## クラウド環境

- **Cloud Security Posture Management (CSPM)**: クラウドプラットフォーム上のセキュリティ設定を監視するためのソフトウェアです。クラウドプラットフォーム上のリソースの設定がベストプラクティスに従っているかどうかをチェックし、不備があればアラートを発生させます。例えば、S3バケットがパブリックになっている、IAMロールに不要な権限が付与されている、などを検知することができます。
- **クラウドプラットフォーム提供のセキュリティ監視サービス**: クラウドプラットフォームが主体となって提供しているセキュリティ監視サービスもあります。例えば、AWSのGuardDutyやGoogle CloudのSecurity Command Centerなどがあります。これらのサービスもCSPM同様にベストプラクティスをもとに設定のチェックをするだけでなく、クラウドプラットフォームのリソースアクセスやインスタンス上での不審な挙動を検知することもできます。
- **SaaSに付帯するセキュリティ監視サービス**: SaaSプラットフォームを提供している企業が、そのプラットフォーム上で不審な挙動があればアラートしてくれるサービスもあります。例えば、Google WorkspaceやEntra IDなどがあります。これらは、不審なログイン、不審なリソースへのアクセス、不審な権限操作、脆弱と思われる設定などを検知することができます。

# まとめ

セキュリティ監視基盤においては、自分たちでログ分析をしてアラート検知をするだけでなく、既製のセキュリティ対策ソフトウェア・サービスが検知するアラートを活用することで、より効率的にセキュリティ監視ができます。アラートは別々のシステムで取り扱うこともできますが、最終的には統合して一元管理することがおすすめです。
