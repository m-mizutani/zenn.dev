---
title: "はじめに"
---

筆者は約25年ほど、大学時代よりセキュリティ監視の効率化をエンジニアリングで解く方法に向き合ってきました。分析に必要な情報を整理するソフトウェアや検知システムそのものなどの実装に取り組んできましたが、特にクラウド時代になってシステム間の統合がされやすくなってからは、分析プロセスの自動化は大幅にやりやすくなりました。

しかし従来のプログラミングによるソフトウェアでは、どうしても決定性の高いアプローチ[^anomaly]になります。決定性のあるアプローチ自体は悪くありませんが、セキュリティ分析では対応する事象が多岐にわたり、それぞれに対して細かくルールやロジックを設定しなければならないという課題がありました。これによってルール整備するInvestに対して得られるReturnが微妙になるという問題がつきまとい、セキュリティ監視と分析の効率化が滞っていました。筆者はソフトウェア開発のベストプラクティスを持ち込みテストなどでこの問題を解決しようとしましたが、結局あまりうまくはいきませんでした。

[^anomaly]: もちろん非決定的な異常検知手法などもあったが、現実として適用できても局所的なドメインのみであり、自動化などにおいては決定性のあるアプローチを取らざるを得なかった

そこに登場したのが大規模言語モデル（LLM）をはじめとする生成AIです。もちろん確率実行なので不確実性はありますが、これまで細かに色々ロジックやルールを組まないといけなかったものを「よしなに」対応できるようになりました。また情報さえ与えれば「妥当」な推論はしてくれます。この特性が、様々なタスクの効率化の可能性を感じさせました。

それから筆者はこの生成AIをどうにかセキュリティ監視や分析の領域で活用できないか模索していました。この取り組みは2024年末から始めていましたが、最初は情報の整理やルール調整などを試していたものの、あまり目覚ましい結果を得られませんでした。しかし徐々にエージェント的な使い方によって分析のサポートをさせるとよいということに気づき始めました。このきっかけの一つとなったのが、2025年5月にAnthropic社が出したsonnet 4モデルとclaude codeです。これまでとは比べ物にならない性能でコーディングをはじめたのを見て、エージェント的なアプローチの可能性を強く認識しました。

こうしてセキュリティ分析の[生成AIエージェント](https://github.com/secmon-lab/warren)を作り始めたのが2025年3月頃です。そこからずっと開発を続けてきて、今では実業務でも利用しています。この本は、そのときの苦労をまとめて文章化したものです。当時の自分がこのあたりを読むといろいろ手がかりになったであろうことをまとめて書き出しました。

現代においてLLMエージェントを自作するのは必ずしも正解ではありません。ChatGPTやClaude、その他多くの既存サービスが十分に利用できる環境があります。しかし、特定のドメインや業務フローに深く組み込む必要がある場合、自作という選択肢も有効です。この本が、なんらかの形で読者の役に立てば幸いです。

---

# 目次

本書は全20章で構成されており、以下の6つのパートに分かれています。

## Part 1: 導入と基礎（第2-4章）

2. [セキュリティアラート分析とLLMエージェント](02-introduction)
3. [セキュリティアラートの分析業務における課題とLLMによる改善の可能性](03-challenges)
4. [システムアーキテクチャと設計方針](04-architecture)

本書の目的と背景を説明し、セキュリティアラート分析における課題とLLMによる解決アプローチを議論します。そして構築するエージェントのシステムアーキテクチャと設計方針を解説します。

## Part 2: 開発環境とLLM基礎（第5-8章）

5. [開発環境の準備と事前実装済みコードの説明](05-setup)
6. [LLM利用の基礎とアラートの説明文の作成](06-llm-basics)
7. [構造化データ出力でIoCなど属性値を抽出する](07-structured-output)
8. [会話と履歴の管理](08-conversation-history)

開発環境のセットアップから始まり、LLM APIの基本的な使い方、構造化データ出力によるIoC抽出、会話履歴の管理など、LLMエージェントの基礎を学びます。

## Part 3: 外部ツール連携（第9-12章）

9. [Function Callingによる外部ツール連携](09-function-calling)
10. [シンプルなツールの実装：脅威インテリジェンスツール](10-threat-intel)
11. [より実践的なツールの実装：BigQueryからのログ取得](11-log-db)
12. [エージェントのプロンプトエンジニアリング](12-prompt-engineering)

Function Callingによる外部ツール連携の仕組みを理解し、脅威インテリジェンスAPIやログデータベースとの実践的な連携を実装します。さらにプロンプトエンジニアリングでエージェントの動作を最適化します。

## Part 4: エージェント制御の高度化（第13-15章）

13. [コンテキスト圧縮とサブエージェントパターン](13-context-subagent)
14. [AIワークフロー - 設計と実装](14-ai-workflow)
15. [Plan & Execute パターン - 設計と実装](15-plan-execute)

コンテキスト圧縮とサブエージェントパターンで会話の制限を克服し、AIワークフローで決定性と柔軟性を両立させます。そしてPlan & Executeパターンで複雑な調査タスクを段階的に実行する方法を学びます。

## Part 5: 記憶と学習（第16-17章）

16. [Embeddingとエージェントの記憶システム](16-embedding-memory)
17. [エージェントの記憶システム実装](17-memory-implementation)

Embeddingによる類似度検索と記憶システムの設計を学び、過去の対応履歴を活用するRAGパターンを実装します。これによりエージェントが経験から学習できるようになります。

## Part 6: 実用化と発展（第18-21章）

18. [セキュリティ分析のためのツール・サブエージェント](18-tools-agents-overview)
19. [エージェントのテスト](19-testing)
20. [MCPによるツール利用の拡張](20-mcp)
21. [実運用への統合と今後の展望](21-integration-future)

セキュリティ分析に有用なツールとサブエージェントを概説し、LLMエージェントのテスト戦略を解説します。MCPによるツール拡張性を確保し、最後に実運用への統合と今後の技術展望を議論します。
